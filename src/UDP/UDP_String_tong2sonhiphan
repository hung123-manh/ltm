package UDP;

import java.net.*;

public class UDP_String_GgjLBkve {

    public static void main(String[] args) throws Exception {

        String studentCode = "B22DCAT134";   // đổi nếu cần
        String qCode = "GgjLBkve";
        String serverIp = "203.162.10.109";  // IP server thi
        int serverPort = 2208;

        DatagramSocket socket = new DatagramSocket();
        socket.setSoTimeout(5000);

        InetAddress serverAddress = InetAddress.getByName(serverIp);

        // ===== a. Gửi studentCode;qCode =====
        String sendMsg = ";" + studentCode + ";" + qCode;
        byte[] sendData = sendMsg.getBytes();
        DatagramPacket sendPacket = new DatagramPacket(sendData, sendData.length, serverAddress, serverPort);
        socket.send(sendPacket);

        // ===== b. Nhận requestId;b1,b2 =====
        byte[] buffer = new byte[1024];
        DatagramPacket receivePacket = new DatagramPacket(buffer, buffer.length);
        socket.receive(receivePacket);

        String receiveMsg = new String(receivePacket.getData(), 0, receivePacket.getLength());

        // ===== c. Xử lý =====
        String[] parts = receiveMsg.split(";");
        String requestId = parts[0];

        String[] binaries = parts[1].split(",");
        int b1 = Integer.parseInt(binaries[0], 2);
        int b2 = Integer.parseInt(binaries[1], 2);

        int sum = b1 + b2;

        // ===== d. Gửi kết quả =====
        String result = requestId + ";" + sum;
        byte[] resultData = result.getBytes();
        DatagramPacket resultPacket = new DatagramPacket(resultData, resultData.length, serverAddress, serverPort);
        socket.send(resultPacket);

        socket.close();
    }
}
