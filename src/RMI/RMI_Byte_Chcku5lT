/*
Thực hiện mã hóa Caesar
 Ví dụ: Nếu dữ liệu nhị phân nhận được là [72, 101, 108, 108, 111] (tương ứng với chuỗi "Hello"), 
chương trình sẽ thực hiện mã hóa Caesar với độ dịch là 5. Kết quả mã hóa là mảng [77, 108, 113, 113, 116],
tương ứng với chuỗi "Mlqqt".
 */
package RMI;

import java.rmi.NotBoundException;
import java.rmi.RemoteException;
import java.rmi.registry.LocateRegistry;
import java.rmi.registry.Registry;
import java.util.Arrays;

// ===== Interface từ xa =====
interface ByteService extends java.rmi.Remote {
    byte[] requestData(String studentCode, String qCode) throws java.rmi.RemoteException;
    void submitData(String studentCode, String qCode, byte[] data) throws java.rmi.RemoteException;
}

// ===== Chương trình Client =====
public class RMI_Byte_Chcku5lT {

    public static void main(String[] args) {
        try {
            // (a) Kết nối đến RMI Registry
            String host = "203.162.10.109";  // Địa chỉ server
            int port = 1099;                 // Cổng RMI mặc định
            Registry registry = LocateRegistry.getRegistry(host, port);

            // Lấy đối tượng từ xa
            ByteService service = (ByteService) registry.lookup("RMIByteService");

            // Thông tin sinh viên & mã câu hỏi
            String studentCode = "B22DCAT134";
            String qCode = "Chcku5lT";

            // (a) Gọi requestData để nhận dữ liệu nhị phân
            byte[] data = service.requestData(studentCode, qCode);
            System.out.println("Dữ liệu gốc (byte[]): " + Arrays.toString(data));
            System.out.println("Dữ liệu gốc (chuỗi): " + new String(data));

            // (b) Mã hóa Caesar – độ dịch = độ dài mảng
            int shift = data.length;
            byte[] encoded = caesarEncode(data, shift);
            System.out.println("Sau mã hóa (byte[]): " + Arrays.toString(encoded));
            System.out.println("Sau mã hóa (chuỗi): " + new String(encoded));

            // (c) Gửi dữ liệu mã hóa trở lại server
            service.submitData(studentCode, qCode, encoded);
            System.out.println("Đã gửi dữ liệu mã hóa trở lại server.");

            // (d) Kết thúc chương trình
            System.out.println("Client kết thúc.");

        } catch (NotBoundException | RemoteException e) {
        }
    }

    // ===== Hàm mã hóa Caesar =====
private static byte[] caesarEncode(byte[] data, int shift) {
    byte[] result = new byte[data.length];
    for (int i = 0; i < data.length; i++) {
        result[i] = (byte) (data[i] + shift);
    }
    return result;
}
}
