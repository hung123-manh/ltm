package RMI;

import java.rmi.NotBoundException;
import java.rmi.RemoteException;
import java.rmi.registry.LocateRegistry;
import java.rmi.registry.Registry;
import java.util.LinkedHashMap;
import java.util.Map;

public class RMI_Character_77LFDUuQ {

    public static void main(String[] args) {
        try {
            String host = "203.162.10.109";
            int port = 1099;

            Registry registry = LocateRegistry.getRegistry(host, port);
            CharacterService service =
                    (CharacterService) registry.lookup("RMICharacterService");

            String studentCode = "B22DCAT134";
            String qCode = "77LFDUuQ";

            // (a) Nhận chuỗi
            String input = service.requestCharacter(studentCode, qCode);
            System.out.println("Chuỗi nhận: " + input);

            // (b) Đếm ký tự (GIỮ THỨ TỰ)
            Map<Character, Integer> countMap = new LinkedHashMap<>();
            for (char c : input.toCharArray()) {
                countMap.put(c, countMap.getOrDefault(c, 0) + 1);
            }

            // (c) Tạo chuỗi kết quả ĐÚNG FORMAT
            StringBuilder sb = new StringBuilder();
            sb.append("{");
            int i = 0;
            for (Map.Entry<Character, Integer> e : countMap.entrySet()) {
                sb.append("\"").append(e.getKey()).append("\": ")
                  .append(e.getValue());
                if (i < countMap.size() - 1) {
                    sb.append(", ");
                }
                i++;
            }
            sb.append("}");

            String result = sb.toString();
            System.out.println("Kết quả gửi: " + result);

            // (d) Gửi lại server
            service.submitCharacter(studentCode, qCode, result);
            System.out.println("Client kết thúc.");

        } catch (NotBoundException | RemoteException e) {
        }
    }
}
